_format_version: "3.0"

services:
  - name: biometric_auth
    url: http://localhost:3002
  - name: secure_server
    url: http://localhost:3001
  - name: non_secure_server
    url: http://localhost:3000

routes:
  - service: biometric_auth
    paths: ['/bio-mfa']
  - service: secure_server
    paths: ['/vault']
  - service: non_secure_server
    paths: ['/unsafe']

consumers:
  - username: anonymous_users
  # manually set to fixed uuid in order to use it in key-auth plugin
    id: 81823632-10c0-4098-a4f7-31062520c1e6
  - username: admin
  - username: simple

keyauth_credentials:
  - consumer: admin
    key: admin_key
  - consumer: simple
    key: simple_key

plugins:
  - name: key-auth
    service: secure_server
    config:
      # using the anonymous consumer fixed uuid (can't use the username)
      anonymous: 81823632-10c0-4098-a4f7-31062520c1e6
      # cookie_secure is true by default, and should always be true,
      # but is set to false for the sake of this demo in order to avoid using HTTPS.
      cookie_secure: false
  - name: session
    config:
      storage: kong
      cookie_secure: false
  - name: request-termination
    service: secure_server
    consumer: anonymous_users
    config:
      status_code: 403
      message: 'So long and thanks for all the fish!'

